(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3669:(e,s,t)=>{Promise.resolve().then(t.bind(t,2005))},1276:(e,s,t)=>{"use strict";t.d(s,{Q:()=>a});var l=t(7437);function a(e){let{children:s,rail:t=!0,className:a=""}=e;return(0,l.jsx)("section",{className:"relative holo-glass hover-lift ".concat(t?"neon-rail pl-4":""," ").concat(a),children:(0,l.jsx)("div",{className:"p-4",children:s})})}t(2265)},6925:(e,s,t)=>{"use strict";t.d(s,{E:()=>r});var l=t(7437);t(2265);var a=t(1973);function r(e){let{value:s,onChange:t,placeholder:r="Search..."}=e;return(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(a.I,{value:s,onChange:e=>t(e.target.value),placeholder:r})})}},1973:(e,s,t)=>{"use strict";t.d(s,{I:()=>i});var l=t(7437),a=t(2265),r=t(6164);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("input",{ref:s,className:(0,r.m6)("flex h-9 w-full rounded-md bg-white/5 border border-white/10 px-3 py-2 text-sm shadow-inner outline-none focus:ring-2 focus:ring-cyan-300",t),...a})});i.displayName="Input"},2005:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>z});var l=t(7437),a=t(2265),r=t(1276);function i(e){let{label:s,value:t,accent:a="cyan"}=e;return(0,l.jsxs)(r.Q,{rail:!1,className:"ring-1 ".concat("cyan"===a?"ring-cyan-300":"emerald"===a?"ring-emerald-400":"amber"===a?"ring-amber-300":"ring-purple-400"," ring-opacity-30"),children:[(0,l.jsx)("div",{className:"kpi-number",children:t}),(0,l.jsx)("div",{className:"kpi-label",children:s})]})}var n=t(6164);function d(e){let{className:s,children:t}=e;return(0,l.jsx)("span",{className:(0,n.m6)("inline-flex items-center rounded-full border border-white/15 bg-white/10 px-2 py-0.5 text-xs",s),children:t})}function c(e){let{status:s}=e;return(0,l.jsx)(d,{className:{PENDING:"text-amber-300 border-amber-300/30",BACKORDERED:"text-rose-300 border-rose-300/30",ARRIVED:"text-emerald-300 border-emerald-300/30",SPECIAL:"text-fuchsia-300 border-fuchsia-300/30"}[s],children:s})}var o=t(1538);let m=(0,t(3525).j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-300 disabled:pointer-events-none disabled:opacity-50 hover:brightness-110",{variants:{variant:{default:"bg-white/10 border border-white/10 backdrop-blur-md shadow-glass",ghost:"bg-transparent hover:bg-white/10",outline:"border border-white/20 bg-transparent"},size:{default:"h-9 px-4 py-2",sm:"h-8 px-3",lg:"h-10 px-6"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,s)=>{let{className:t,variant:a,size:r,asChild:i=!1,...d}=e,c=i?o.g7:"button";return(0,l.jsx)(c,{className:(0,n.m6)(m({variant:a,size:r}),t),ref:s,...d})});function x(e){var s,t,a;let{order:r,onArriveClick:i}=e,n="PENDING"===r.status?"glow-amber":"BACKORDERED"===r.status?"glow-red":"SPECIAL"===r.status?"glow-purple":"glow-green";return(0,l.jsx)("article",{className:"relative holo-glass neon-rail hover-lift ".concat(n),children:(0,l.jsxs)("div",{className:"p-4 flex items-start gap-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c,{status:r.status}),(0,l.jsxs)("div",{className:"text-sm text-white/70",children:["PO# ",r.po_number]})]}),(0,l.jsx)("h3",{className:"mt-1 text-lg font-semibold",children:null!==(s=r.item_display_name)&&void 0!==s?s:"(Unnamed Item)"}),(0,l.jsxs)("div",{className:"mt-1 text-sm text-white/70",children:["Supplier: ",null!==(t=r.supplier_name)&&void 0!==t?t:"—"]}),"SPECIAL"===r.status&&r.deceased_name?(0,l.jsxs)("div",{className:"mt-1 text-sm text-white/70",children:["Deceased: ",r.deceased_name]}):null,(0,l.jsxs)("div",{className:"mt-1 text-sm text-white/70",children:["Expected: ",r.tbd_expected?"TBD":null!==(a=r.expected_date)&&void 0!==a?a:"—",r.backordered?" • Backordered":""]})]}),(0,l.jsx)("div",{className:"flex flex-col items-end gap-2",children:"ARRIVED"!==r.status?(0,l.jsx)(u,{onClick:()=>i(r),children:"Mark Delivered"}):(0,l.jsxs)("div",{className:"text-xs text-emerald-300",children:["Arrived ",r.arrived_at?new Date(r.arrived_at).toLocaleString():""]})})]})})}u.displayName="Button";var h=t(6286),p=t(7025);let v=h.fC,j=h.xz,f=h.h_,b=h.x8;function g(e){return(0,l.jsx)(h.aV,{...e,className:(0,n.m6)("fixed inset-0 z-50 bg-black/60 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out",e.className)})}function N(e){let{className:s,children:t,...a}=e;return(0,l.jsxs)(f,{children:[(0,l.jsx)(g,{}),(0,l.jsxs)(h.VY,{...a,className:(0,n.m6)("fixed left-1/2 top-1/2 z-50 w-[95vw] max-w-2xl -translate-x-1/2 -translate-y-1/2 holo-glass p-6 shadow-glass",s),children:[t,(0,l.jsx)(b,{className:"absolute right-4 top-4 text-white/70 hover:text-white","aria-label":"Close",children:(0,l.jsx)(p.Z,{className:"h-5 w-5"})})]})]})}function _(e){let{children:s}=e;return(0,l.jsx)("div",{className:"mb-4 space-y-1",children:s})}function C(e){let{children:s}=e;return(0,l.jsx)("h3",{className:"text-lg font-semibold",children:s})}function w(e){let{children:s}=e;return(0,l.jsx)("p",{className:"text-sm text-white/70",children:s})}var y=t(1973),k=t(9772);let E=k.z.enum(["casket","urn"]);k.z.enum(["PENDING","BACKORDERED","ARRIVED","SPECIAL"]);let S=k.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Expected YYYY-MM-DD").nullable().optional().transform(e=>""===e?null:null!=e?e:null),D=k.z.object({item_type:E,item_id:k.z.number().int().nullable().optional().default(null),item_name:k.z.string().min(1).max(200).nullable().optional().default(null),po_number:k.z.string().min(1).max(120),expected_date:S,backordered:k.z.boolean().default(!1),tbd_expected:k.z.boolean().default(!1),special_order:k.z.boolean().default(!1),deceased_name:k.z.string().min(1).max(200).nullable().optional().default(null)}).refine(e=>e.special_order?!!e.item_name&&null===e.item_id:null!==e.item_id&&!e.item_name,{message:"For special orders use item_name (item_id null). For normal orders use item_id (no item_name)."}).refine(e=>!!e.backordered||!!e.tbd_expected||!!e.expected_date,{message:"Either provide expected_date or mark as backordered/TBD."}),I=k.z.object({received_by:k.z.string().min(1).max(120),arrived_at:k.z.string().datetime().optional()});var R=t(6925);function A(e){let[s,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{fetch(e).then(e=>e.json()).then(t).catch(()=>t(null))},[e]),s}function O(e){let{onCreated:s}=e,t=A("/api/caskets"),r=A("/api/urns"),i=A("/api/suppliers"),[n,d]=(0,a.useState)(!1),[c,o]=(0,a.useState)(!1),[m,x]=(0,a.useState)("casket"),[h,p]=(0,a.useState)(null),[f,b]=(0,a.useState)(""),[g,k]=(0,a.useState)(""),[E,S]=(0,a.useState)(!1),[I,O]=(0,a.useState)(!1),[P,z]=(0,a.useState)(""),[B,L]=(0,a.useState)(""),M=(0,a.useMemo)(()=>"casket"===m?null!=t?t:[]:null!=r?r:[],[m,t,r]),[V,G]=(0,a.useState)(""),K=(0,a.useMemo)(()=>{let e=V.trim().toLowerCase();return e?M.filter(s=>s.name.toLowerCase().includes(e)):M},[M,V]),Y=(0,a.useMemo)(()=>{var e;if(c)return null;let s=M.find(e=>e.id===h);return null!==(e=null==s?void 0:s.supplier_id)&&void 0!==e?e:null},[c,M,h]),F=(0,a.useMemo)(()=>{var e;return null==Y?null:null!==(e=null==i?void 0:i.find(e=>e.id===Y))&&void 0!==e?e:null},[i,Y]),T=(0,a.useMemo)(()=>{try{if(D.parse({item_type:m,item_id:c?null:h,item_name:c&&f||null,po_number:g,expected_date:P||null,backordered:E,tbd_expected:I,special_order:c,deceased_name:c&&B||null}),!c&&!Y)return!1;return!0}catch(e){return!1}},[m,c,h,f,g,P,E,I,B,Y]);async function U(){let e=await fetch("/api/orders",{method:"POST",body:JSON.stringify({item_type:m,item_id:c?null:h,item_name:c?f:null,po_number:g,expected_date:P||null,backordered:E,tbd_expected:I,special_order:c,deceased_name:c&&B||null})});e.ok?(d(!1),null==s||s(),o(!1),p(null),b(""),k(""),S(!1),O(!1),z(""),L("")):alert("Failed to create order: "+await e.text())}return(0,l.jsxs)(v,{open:n,onOpenChange:d,children:[(0,l.jsx)(j,{asChild:!0,children:(0,l.jsx)(u,{children:"New Order"})}),(0,l.jsxs)(N,{children:[(0,l.jsxs)(_,{children:[(0,l.jsx)(C,{children:"Create Order"}),(0,l.jsx)(w,{children:"When an item is sold, create its order here."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm",children:"Item Type"}),(0,l.jsxs)("div",{className:"mt-1 flex gap-2",children:[(0,l.jsx)(u,{variant:"casket"===m?"default":"outline",onClick:()=>x("casket"),children:"Casket"}),(0,l.jsx)(u,{variant:"urn"===m?"default":"outline",onClick:()=>x("urn"),children:"Urn"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm",children:"Special Order"}),(0,l.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,l.jsx)(u,{variant:c?"default":"outline",onClick:()=>o(!0),children:"Yes"}),(0,l.jsx)(u,{variant:c?"outline":"default",onClick:()=>o(!1),children:"No"})]})]}),c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("label",{className:"text-sm",children:"Custom Item Name (Special Order)"}),(0,l.jsx)(y.I,{className:"mt-1",placeholder:"Describe the special item...",value:f,onChange:e=>b(e.target.value)}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("label",{className:"text-sm",children:"Name of Deceased (optional)"}),(0,l.jsx)(y.I,{className:"mt-1",placeholder:"Only for special orders",value:B,onChange:e=>L(e.target.value)})]})]}),(0,l.jsx)("div",{className:"md:col-span-2 text-sm text-white/70",children:"Supplier is chosen server‑side (NorthStar preferred if present). Adjust logic in API if needed."})]}):(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("label",{className:"text-sm",children:"Item"}),(0,l.jsxs)("div",{className:"mt-1 grid gap-2",children:[(0,l.jsx)(R.E,{value:V,onChange:G,placeholder:"Search ".concat(m,"s...")}),(0,l.jsxs)("div",{className:"max-h-40 overflow-auto rounded-md border border-white/10 bg-white/5",children:[K.map(e=>(0,l.jsx)("button",{onClick:()=>p(e.id),className:"w-full text-left px-3 py-2 text-sm hover:bg-white/10 ".concat(h===e.id?"bg-white/10":""),children:e.name},e.id)),0===K.length&&(0,l.jsx)("div",{className:"px-3 py-2 text-sm text-white/60",children:"No items found."})]})]}),F?(0,l.jsxs)("div",{className:"mt-3 text-sm",children:[(0,l.jsxs)("div",{className:"text-white/80",children:[(0,l.jsx)("b",{children:"Supplier:"})," ",F.name," (auto‑selected)"]}),F.ordering_instructions&&(0,l.jsxs)("div",{className:"mt-1 text-white/70",children:[(0,l.jsx)("b",{children:"Ordering instructions:"})," ",F.ordering_instructions]})]}):(0,l.jsx)("div",{className:"mt-3 text-sm text-white/50",children:"Supplier will auto‑fill from the selected item."})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm",children:"PO#"}),(0,l.jsx)(y.I,{className:"mt-1",value:g,onChange:e=>k(e.target.value),placeholder:"Required"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,l.jsx)("label",{className:"text-sm",children:"Expected Delivery"}),(0,l.jsx)(y.I,{className:"mt-1",type:"date",value:P,onChange:e=>z(e.target.value),disabled:E||I}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(u,{variant:E?"default":"outline",onClick:()=>{S(!0),O(!1),z("")},children:"Backordered"}),(0,l.jsx)(u,{variant:I?"default":"outline",onClick:()=>{O(!0),S(!1),z("")},children:"TBD"}),(E||I)&&(0,l.jsx)(u,{variant:"outline",onClick:()=>{S(!1),O(!1)},children:"Clear"})]})]})]}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,l.jsx)(u,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,l.jsx)(u,{onClick:U,disabled:!T,children:"Create"})]})]})]})}function P(e){let{order:s,onCompleted:t,triggerLabel:r="Mark Delivered"}=e,[i,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)("");async function o(){let e={received_by:d,arrived_at:new Date().toISOString()};try{I.parse(e)}catch(e){alert("Please fill 'Received by'.");return}let l=await fetch("/api/orders/".concat(s.id,"/arrive"),{method:"PATCH",body:JSON.stringify(e)});l.ok?(n(!1),null==t||t()):alert("Failed: "+await l.text())}return(0,l.jsxs)(v,{open:i,onOpenChange:n,children:[(0,l.jsx)(j,{asChild:!0,children:(0,l.jsx)(u,{children:r})}),(0,l.jsxs)(N,{children:[(0,l.jsx)(_,{children:(0,l.jsxs)(C,{children:["Mark Delivered — PO ",s.po_number]})}),(0,l.jsxs)("div",{className:"grid gap-3",children:[(0,l.jsx)("label",{className:"text-sm",children:"Received By"}),(0,l.jsx)(y.I,{value:d,onChange:e=>c(e.target.value),placeholder:"Your name"})]}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,l.jsx)(u,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),(0,l.jsx)(u,{onClick:o,disabled:!d,children:"Save"})]})]})]})}function z(){let[e,s]=(0,a.useState)([]),[t,n]=(0,a.useState)("");async function d(){let e=await fetch("/api/orders");s(await e.json())}(0,a.useEffect)(()=>{d()},[]);let c=(0,a.useMemo)(()=>{let s=t.trim().toLowerCase();return s?e.filter(e=>{var t,l,a;return(null!==(t=e.item_display_name)&&void 0!==t?t:"").toLowerCase().includes(s)||(null!==(l=e.po_number)&&void 0!==l?l:"").toLowerCase().includes(s)||(null!==(a=e.supplier_name)&&void 0!==a?a:"").toLowerCase().includes(s)}):e},[e,t]),o=(0,a.useMemo)(()=>{let e=c.filter(e=>"casket"===e.item_type).length;return{totalCasket:e,totalUrn:c.filter(e=>"urn"===e.item_type).length,suppliers:new Set(c.map(e=>e.supplier_id).filter(Boolean)).size,active:c.filter(e=>"ARRIVED"!==e.status).length}},[c]),m=(0,a.useMemo)(()=>{let e={PENDING:[],BACKORDERED:[],SPECIAL:[],ARRIVED:[]};for(let s of c)e[s.status].push(s);return e},[c]),[u,h]=(0,a.useState)(null);return(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsx)(i,{label:"Caskets",value:o.totalCasket,accent:"cyan"}),(0,l.jsx)(i,{label:"Urns",value:o.totalUrn,accent:"emerald"}),(0,l.jsx)(i,{label:"Suppliers",value:o.suppliers,accent:"purple"}),(0,l.jsx)(i,{label:"Active Orders",value:o.active,accent:"amber"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,l.jsx)(r.Q,{rail:!1,className:"flex-1",children:(0,l.jsx)("div",{className:"flex items-center gap-3",children:(0,l.jsx)(R.E,{value:t,onChange:n,placeholder:"Search orders by item, PO#, or supplier..."})})}),(0,l.jsx)(O,{onCreated:d})]}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"mb-2 font-semibold text-amber-300",children:"PENDING"}),(0,l.jsxs)("div",{className:"space-y-3",children:[m.PENDING.map(e=>(0,l.jsx)(x,{order:e,onArriveClick:e=>h(e)},e.id)),0===m.PENDING.length&&(0,l.jsx)(B,{text:"No pending orders"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"mb-2 font-semibold text-rose-300",children:"BACKORDERED"}),(0,l.jsxs)("div",{className:"space-y-3",children:[m.BACKORDERED.map(e=>(0,l.jsx)(x,{order:e,onArriveClick:e=>h(e)},e.id)),0===m.BACKORDERED.length&&(0,l.jsx)(B,{text:"No backorders"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"mb-2 font-semibold text-fuchsia-300",children:"SPECIAL"}),(0,l.jsxs)("div",{className:"space-y-3",children:[m.SPECIAL.map(e=>(0,l.jsx)(x,{order:e,onArriveClick:e=>h(e)},e.id)),0===m.SPECIAL.length&&(0,l.jsx)(B,{text:"No special orders"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"mb-2 font-semibold text-emerald-300",children:"ARRIVED"}),(0,l.jsxs)("div",{className:"space-y-3",children:[m.ARRIVED.map(e=>(0,l.jsx)(x,{order:e,onArriveClick:e=>h(e)},e.id)),0===m.ARRIVED.length&&(0,l.jsx)(B,{text:"No arrivals yet"})]})]})]}),u&&(0,l.jsx)(P,{order:u,onCompleted:()=>{h(null),d()}})]})}function B(e){let{text:s}=e;return(0,l.jsx)("div",{className:"holo-glass p-4 text-sm text-white/60",children:s})}}},e=>{var s=s=>e(e.s=s);e.O(0,[164,968,130,215,744],()=>s(3669)),_N_E=e.O()}]);