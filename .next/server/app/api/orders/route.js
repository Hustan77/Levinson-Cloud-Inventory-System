(()=>{var e={};e.id=146,e.ids=[146],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2988:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>_,routeModule:()=>u,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{GET:()=>d,POST:()=>l});var a=r(2412),i=r(4293),n=r(4147),o=r(7856);async function d(){let e=Object(function(){var e=Error("Cannot find module '../../lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e}())(),{data:t,error:r}=await e.from("v_orders_enriched").select("*").order("created_at",{ascending:!1});if(r){let t=await e.from("orders").select("*").order("created_at",{ascending:!1});if(t.error)return new o.NextResponse(t.error.message,{status:500});let[r,s,a]=await Promise.all([e.from("suppliers").select("id,name"),e.from("caskets").select("id,name"),e.from("urns").select("id,name")]);if(r.error||s.error||a.error)return o.NextResponse.json(t.data??[],{status:200});let i=new Map;r.data?.forEach(e=>i.set(e.id,e.name));let n=new Map;s.data?.forEach(e=>n.set(e.id,e.name));let d=new Map;a.data?.forEach(e=>d.set(e.id,e.name));let l=t.data?.map(e=>({...e,supplier_name:e.supplier_id?i.get(e.supplier_id)??null:null,item_display_name:"SPECIAL"===e.status?e.item_name:"casket"===e.item_type?e.item_id?n.get(e.item_id)??null:null:e.item_id?d.get(e.item_id)??null:null}))??[];return o.NextResponse.json(l,{status:200})}return o.NextResponse.json(t??[],{status:200})}async function l(e){let t=Object(function(){var e=Error("Cannot find module '../../lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e}())(),r=await e.json(),s=Object(function(){var e=Error("Cannot find module '../../lib/types'");throw e.code="MODULE_NOT_FOUND",e}()).safeParse(r);if(!s.success)return o.NextResponse.json({error:s.error.flatten()},{status:400});let a=s.data,i=null;if(a.special_order){let e=await t.from("suppliers").select("id").ilike("name","%NorthStar%").maybeSingle();if(e.data?.id)i=e.data.id;else{let e=await t.from("suppliers").select("id").limit(1).single();i=e.data?.id??null}}else{if(!a.item_id)return new o.NextResponse("Missing item_id",{status:400});if("casket"===a.item_type){let{data:e,error:r}=await t.from("caskets").select("supplier_id").eq("id",a.item_id).single();if(r)return new o.NextResponse(r.message,{status:400});i=e?.supplier_id??null}else{let{data:e,error:r}=await t.from("urns").select("supplier_id").eq("id",a.item_id).single();if(r)return new o.NextResponse(r.message,{status:400});i=e?.supplier_id??null}}let n="PENDING";a.special_order?n="SPECIAL":(a.backordered||a.tbd_expected)&&(n="BACKORDERED");let d={item_type:a.item_type,item_id:a.special_order?null:a.item_id,item_name:a.special_order?a.item_name:null,supplier_id:i,po_number:a.po_number,expected_date:a.expected_date,status:n,backordered:a.backordered,tbd_expected:a.tbd_expected,deceased_name:a.special_order?a.deceased_name:null},{data:l,error:u}=await t.from("orders").insert(d).select("*").single();return u?new o.NextResponse(u.message,{status:500}):o.NextResponse.json(l,{status:201})}(function(){var e=Error("Cannot find module '../../lib/supabaseServer'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '../../lib/types'");throw e.code="MODULE_NOT_FOUND",e}();let u=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/workspaces/Levinson-Cloud-Inventory-System/src/app/api/orders/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:m}=u;function _(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}},5303:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,814],()=>r(2988));module.exports=s})();