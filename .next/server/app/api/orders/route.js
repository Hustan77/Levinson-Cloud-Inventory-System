(()=>{var e={};e.id=146,e.ids=[146],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8893:e=>{"use strict";e.exports=require("buffer")},7048:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},2988:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>m,serverHooks:()=>x,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>p});var i=r(2412),a=r(4293),n=r(4147),o=r(7856),l=r(8668),d=r(7721);async function u(){let e=(0,l.R)(),t=await e.from("v_orders_enriched").select("*").order("created_at",{ascending:!1});if(!t.error)return o.NextResponse.json(t.data??[],{status:200});let r=await e.from("orders").select("*").order("created_at",{ascending:!1});if(r.error)return new o.NextResponse(r.error.message,{status:500});let[s,i,a]=await Promise.all([e.from("suppliers").select("id,name"),e.from("caskets").select("id,name"),e.from("urns").select("id,name")]),n=new Map;s.data?.forEach(e=>n.set(e.id,e.name));let d=new Map;i.data?.forEach(e=>d.set(e.id,e.name));let u=new Map;a.data?.forEach(e=>u.set(e.id,e.name));let p=r.data?.map(e=>({...e,supplier_name:e.supplier_id?n.get(e.supplier_id)??null:null,item_display_name:"SPECIAL"===e.status?e.item_name:"casket"===e.item_type?e.item_id?d.get(e.item_id)??null:null:e.item_id?u.get(e.item_id)??null:null}))??[];return o.NextResponse.json(p,{status:200})}async function p(e){let t=(0,l.R)(),r=await e.json(),s=d.V7.safeParse(r);if(!s.success)return o.NextResponse.json({error:s.error.flatten()},{status:400});let i=s.data,a=null;if(i.special_order){let e=await t.from("suppliers").select("id").ilike("name","%NorthStar%").maybeSingle();if(e.data?.id)a=e.data.id;else{let e=await t.from("suppliers").select("id").limit(1).single();a=e.data?.id??null}}else{if(!i.item_id)return new o.NextResponse("Missing item_id",{status:400});if("casket"===i.item_type){let{data:e,error:r}=await t.from("caskets").select("supplier_id").eq("id",i.item_id).single();if(r)return new o.NextResponse(r.message,{status:400});a=e?.supplier_id??null}else{let{data:e,error:r}=await t.from("urns").select("supplier_id").eq("id",i.item_id).single();if(r)return new o.NextResponse(r.message,{status:400});a=e?.supplier_id??null}}let n="PENDING";i.special_order?n="SPECIAL":(i.backordered||i.tbd_expected)&&(n="BACKORDERED");let u={item_type:i.item_type,item_id:i.special_order?null:i.item_id,item_name:i.special_order?i.item_name:null,supplier_id:a,po_number:i.po_number,expected_date:i.expected_date,status:n,backordered:i.backordered,tbd_expected:i.tbd_expected,deceased_name:i.special_order?i.deceased_name:null},{data:p,error:m}=await t.from("orders").insert(u).select("*").single();return m?new o.NextResponse(m.message,{status:500}):o.NextResponse.json(p,{status:201})}let m=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/workspaces/Levinson-Cloud-Inventory-System/src/app/api/orders/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:_,serverHooks:x}=m;function f(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:_})}},5303:()=>{},8668:(e,t,r)=>{"use strict";r.d(t,{R:()=>i});var s=r(7420);function i(){let e="https://xwehprkbubnycfinbuio.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase server env vars missing: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY");return(0,s.eI)(e,t,{auth:{persistSession:!1},global:{headers:{"X-Client-Info":"sol-levinson-inventory-server"}}})}},7721:(e,t,r)=>{"use strict";r.d(t,{V7:()=>n,XU:()=>o});var s=r(6475);let i=s.z.enum(["casket","urn"]);s.z.enum(["PENDING","BACKORDERED","ARRIVED","SPECIAL"]);let a=s.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Expected YYYY-MM-DD").nullable().optional().transform(e=>""===e?null:e??null),n=s.z.object({item_type:i,item_id:s.z.number().int().nullable().optional().default(null),item_name:s.z.string().min(1).max(200).nullable().optional().default(null),po_number:s.z.string().min(1).max(120),expected_date:a,backordered:s.z.boolean().default(!1),tbd_expected:s.z.boolean().default(!1),special_order:s.z.boolean().default(!1),deceased_name:s.z.string().min(1).max(200).nullable().optional().default(null)}).refine(e=>e.special_order?!!e.item_name&&null===e.item_id:null!==e.item_id&&!e.item_name,{message:"For special orders use item_name (item_id null). For normal orders use item_id (no item_name)."}).refine(e=>!!e.backordered||!!e.tbd_expected||!!e.expected_date,{message:"Either provide expected_date or mark as backordered/TBD."}),o=s.z.object({received_by:s.z.string().min(1).max(120),arrived_at:s.z.string().datetime().optional()})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,289,475],()=>r(2988));module.exports=s})();